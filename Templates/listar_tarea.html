{% extends 'baseadmin.html' %} {% block title %} Lista de tareas {% endblock %}
{% block body %}

<!-- MENSAJE DE ALERTA SweetAlert2 -->
{% with messages = get_flashed_messages(with_categories=true) %} {% if messages
%}
<ul class="flashes">
  {% for category, message in messages %}
  <script type="text/javascript">
    const Toast = Swal.mixin({
      toast: true,
      position: "top-end",
      showConfirmButton: false,
      timer: 2000,
      timerProgressBar: true,
      didOpen: (toast) => {
        toast.onmouseenter = Swal.stopTimer;
        toast.onmouseleave = Swal.resumeTimer;
      },
    });
    Toast.fire({
      icon: "{{ category }}",
      title: "{{ message }}",
    });
  </script>
  {% endfor %}
</ul>
{% endif %} {% endwith %}

<!-- MENSAJE DE ALERTA PARA ELIMINACION SweetAlert2 -->
<script>
  function confirmarEliminacion(url) {
    Swal.fire({
      title: "Â¿EstÃ¡s seguro?",
      text: "Â¡No podrÃ¡s revertir esto!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#d33",
      cancelButtonColor: "#3085d6",
      confirmButtonText: "SÃ­, eliminar",
      cancelButtonText: "Cancelar",
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = url;
      }
    });
  }
</script>

<script>
  function copiarPortapapeles() {
    const tabla = document.querySelector("table").outerText;
    navigator.clipboard
      .writeText(tabla)
      .then(() => {
        Swal.fire({
          icon: "success",
          title: "Copiado al portapapeles",
          showConfirmButton: false,
          timer: 1500,
        });
      })
      .catch((err) => {
        Swal.fire({
          icon: "error",
          title: "Error al copiar",
          text: err,
        });
      });
  }
</script>

<h1 class="text-center">Lista de Tareas</h1>
<div class="caja">
  {% if tareas %}
  <div class="d-flex justify-content-between mb-3">
    <div>
      <button class="btn btn-outline-primary" onclick="copiarPortapapeles()">
        ðŸ“‹ Copiar
      </button>
      <a href="{{ url_for('exportar_excel') }}" class="btn btn-outline-success"
        >ðŸ“Š Exportar Excel</a
      >
      <a href="{{ url_for('exportar_pdf') }}" class="btn btn-outline-danger"
        >ðŸ“„ Exportar PDF</a
      >
    </div>
    <a href="{{ url_for('tareas_agregadas') }}" class="btn btn-primary"
      >âž• Agregar Tarea</a
    >
  </div>
  <table class="table table-hover table-striped">
    <thead class="table-dark">
      <tr>
        <th scope="col">ID</th>
        <th scope="col">titulo</th>
        <th scope="col">descripcion</th>
        <th scope="col">fecha_creacion</th>
        <th scope="col">fecha_vencimiento</th>
      </tr>
    </thead>
    <tbody>
      {% for tareas in tareas %}
      <tr>
        <td>{{ tareas.id }}</td>
        <td>{{ tareas.titulo }}</td>
        <td>{{ tareas.descripcion }}</td>
        <td>{{ tareas.fecha_creacion }}</td>
        <td>{{ tareas.fecha_vencimiento }}</td>
        <td>
          <a
            href="#"
            class="btn btn-success btn-sm"
            data-bs-toggle="modal"
            data-bs-target="#modaledit{{ tareas.id }}"
            >Editar</a
          >
          <a
            href="javascript:void(0);"
            title="Eliminar tarea..."
            onclick="confirmarEliminacion('/borrar_tareas/{{ tareas.id }}')"
            class="btn btn-danger btn-sm"
            >Eliminar</a
          >
        </td>
      </tr>

      <!-- MODAL EDITAR PRODUCTO -->
      <div
        class="modal fade"
        id="modaledit{{ tareas.id }}"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div
              class="modal-header"
              style="
                background: linear-gradient(220deg, #ffffff, #7a9f7a, #355e3b);
              "
            >
              <h4 class="modal-title text-white">Editar Tarea</h4>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <form
              action="{{ url_for('editar_tarea', id=tareas.id) }}"
              method="POST"
            >
              <div class="modal-body">
                <div class="form-group mb-2">
                  <label>Titulo de la tarea</label>

                  <input
                    type="text"
                    name="titulo"
                    class="form-control"
                    value="{{ tareas.titulo }}"
                    required
                  />
                </div>

                <div class="form-group mb-2">
                  <label>descripcion</label>
                  <input
                    type="text"
                    step="0.01"
                    name="descripcion"
                    class="form-control"
                    value="{{ tareas.descripcion }}"
                    required
                  />
                </div>
                <div class="form-group mb-2">
                  <label>Fecha de creacion</label>
                  <input
                    type="date"
                    name="fecha_creacion"
                    class="form-control"
                    value="{{ tareas.fecha_creacion }}"
                    required
                  />
                </div>
                <div class="form-group mb-2">
                  <label>Fecha de vencimiento</label>
                  <input
                    type="date"
                    name="fecha_creacion"
                    class="form-control"
                    value="{{ tareas.fecha_vencimiento }}"
                    required
                  />
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Cancelar
                </button>
                <button type="submit" class="btn btn-primary">
                  Actualizar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- FIN MODAL EDITAR PRODUCTO -->
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-center mt-4">No hay tareas registradas.</p>
  {% endif %}
</div>

{% endblock %}
